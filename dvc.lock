schema: '2.0'
stages:
  data_preprocessing_soil:
    cmd: python3 src/suelo/data_preprocessing.py
    deps:
    - path: data/Division_politica/mun22gw.shp
      hash: md5
      md5: ac48878728d197a5c4310916da7be782
      size: 61118020
    - path: data/Edafologia_perfilsuelo
      hash: md5
      md5: 80d624e891f5db07f0e583f4b772be73.dir
      size: 1373882320
      nfiles: 1889
    - path: data/Suelo_vegetacion
      hash: md5
      md5: efe36208577351ca35ecd3f418d94605.dir
      size: 464192450
      nfiles: 15
    - path: src/suelo/data_preprocessing.py
      hash: md5
      md5: 141354bf096adbf39c38c12c8e393da1
      size: 19526
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
    params:
      params.yaml:
        data_preprocessing_soil.k_neighbors: 5
        data_preprocessing_soil.threshold_m: 20000
    outs:
    - path: data/processed/suelo/suelo_merged.parquet
      hash: md5
      md5: e30207dbdaec8fb36948db04323d8f95
      size: 61477933
  data_preprocessing_seeds:
    cmd: python3 src/cultivos/data_preprocessing.py
    deps:
    - path: data/Sitios/Cierre_agricola_mun_2024.csv
      hash: md5
      md5: da11b7625413607c2eb5ced437470d4e
      size: 6655713
    - path: src/cultivos/data_preprocessing.py
      hash: md5
      md5: 6293c060bc1c0404c282761144bbd435
      size: 7364
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
    params:
      params.yaml:
        data_preprocessing_seeds.lower_bound: 0.8
    outs:
    - path: data/processed/cultivos/evaluacion_cultivos.parquet
      hash: md5
      md5: 834d11f586df0cac5be31830c8b730e1
      size: 373237
    - path: data/processed/cultivos/municipios_principales.parquet
      hash: md5
      md5: 365630138b593cd950128f4ef3f9253a
      size: 2465
  data_merging_climate:
    cmd: python3 src/clima/data_merging.py
    deps:
    - path: data/datos_climatologicos
      hash: md5
      md5: 9dd6d524d32e6fffbdcb623be131cc28.dir
      size: 1083759099
      nfiles: 2493
    - path: src/clima/data_merging.py
      hash: md5
      md5: e913096a9b7a1e6d77aea30c3ba52e32
      size: 6777
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
    params:
      params.yaml:
        data_merging_climate.end_date:
        - 2024
        - 12
        - 31
        data_merging_climate.start_date:
        - 2013
        - 1
        - 1
    outs:
    - path: data/processed/clima/climatologia_todos_los_archivos.csv
      hash: md5
      md5: 1f8dfdd778d997e7a6911bdb061ddfd5
      size: 110858568
  data_cleaning_climate:
    cmd: python3 src/clima/data_cleaning.py
    deps:
    - path: data/processed/clima/climatologia_todos_los_archivos.csv
      hash: md5
      md5: 1f8dfdd778d997e7a6911bdb061ddfd5
      size: 110858568
    - path: src/clima/data_cleaning.py
      hash: md5
      md5: c2dc9f0e234da414c5eb3939f1f23a77
      size: 4921
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
    params:
      params.yaml:
        data_cleaning_climate.date_limit: '2024-06-30'
        data_cleaning_climate.method: linear
        data_cleaning_climate.threshold: 0.4
    outs:
    - path: data/processed/clima/climatologia_limpio.csv
      hash: md5
      md5: 3f09844b0268235156060a83e4f6bd35
      size: 64402144
  data_integration_climate:
    cmd: python3 src/clima/data_integration.py
    deps:
    - path: data/Division_politica/mun22gw.shp
      hash: md5
      md5: ac48878728d197a5c4310916da7be782
      size: 61118020
    - path: data/processed/clima/climatologia_limpio.csv
      hash: md5
      md5: 3f09844b0268235156060a83e4f6bd35
      size: 64402144
    - path: src/clima/data_integration.py
      hash: md5
      md5: 2b7a6d54ee488adbf60480bc0a82967d
      size: 9235
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
    params:
      params.yaml:
        data_integration_climate.threshold_m: 20000
    outs:
    - path: data/processed/clima/climatologia_merged.parquet
      hash: md5
      md5: 160f094683bacd4275d28c29c7866b08
      size: 24106888
  model_building:
    cmd: python3 src/model/model_building.py
    deps:
    - path: data/processed/clima/climatologia_merged.parquet
      hash: md5
      md5: 160f094683bacd4275d28c29c7866b08
      size: 24106888
    - path: data/processed/cultivos/evaluacion_cultivos.parquet
      hash: md5
      md5: 834d11f586df0cac5be31830c8b730e1
      size: 373237
    - path: data/processed/cultivos/municipios_principales.parquet
      hash: md5
      md5: 365630138b593cd950128f4ef3f9253a
      size: 2465
    - path: data/processed/suelo/suelo_merged.parquet
      hash: md5
      md5: e30207dbdaec8fb36948db04323d8f95
      size: 61477933
    - path: src/homology.py
      hash: md5
      md5: 7bd846556d564018a9da89bc81a2a304
      size: 4945
    - path: src/model/model_building.py
      hash: md5
      md5: 0be93ab202f1c9642c6ac2b13a7989ab
      size: 13323
    - path: src/model/model_similarity.py
      hash: md5
      md5: 34bc4aca62afe2265702309f0360ae55
      size: 28122
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
    params:
      params.yaml:
        model_building.candidate:
        - 0.1
        - 0.15
        - 0.4
        - 0.35
        model_building.device: gpu
        model_building.general_params:
          dim: 8
          time: 32
          stride: 1
        model_building.metric: wasserstein
        model_building.optimize:
          n_initial: 2000
          m_refine: 30
          refine_delay: 0.9
          seed: 42
          parameters_type: fixed
        model_building.params_list:
        - embedding_dimension: 7
          embedding_time_delay: 28
          epsilon: 0.07
        - embedding_dimension: 7
          embedding_time_delay: 29
          epsilon: 0.075
        - embedding_dimension: 14
          embedding_time_delay: 33
          epsilon: 0.04
    outs:
    - path: output_aux/aux_model_building.txt
      hash: md5
      md5: d8ebd14807470165da1ce72420723619
      size: 78
  preprocessing_app_data:
    cmd: python3 src/preprocess_app.py
    deps:
    - path: data/Division_politica/mun22gw.shp
      hash: md5
      md5: ac48878728d197a5c4310916da7be782
      size: 61118020
    - path: data/processed/cultivos/evaluacion_cultivos.parquet
      hash: md5
      md5: 834d11f586df0cac5be31830c8b730e1
      size: 373237
    - path: data/processed/suelo/suelo_merged.parquet
      hash: md5
      md5: e30207dbdaec8fb36948db04323d8f95
      size: 61477933
    - path: flask_app/results/similarity_matrix.parquet
      hash: md5
      md5: 5f55286fc7ca024c22e2acfb9047cf05
      size: 1579422
    - path: output_aux/aux_model_building.txt
      hash: md5
      md5: d8ebd14807470165da1ce72420723619
      size: 78
    - path: src/preprocess_app.py
      hash: md5
      md5: 7763a4c45d06cbd32614cf5938c4fe80
      size: 9499
    - path: src/utils.py
      hash: md5
      md5: 1968dcadfb4b312f2b0594938026dc14
      size: 3731
